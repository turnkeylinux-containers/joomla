#!/bin/bash
set -exuo pipefail

declare -r BDEPS=(
    curl
)

declare -r DEPS=(
    php-bz2
    php-gd
    php-ldap
    php-mysql
    php-zip
    php-xml
)

apt-get install "${BDEPS[@]}" "${DEPS[@]}"

declare -r SHA1="c263ccf8abcd120930bb8acf8dd38fcc2d172923" # 3.9.4
declare -r URL="https://github.com/joomla/joomla-cms/releases/download/${PRODUCT_VERSION}/Joomla_${PRODUCT_VERSION}-Stable-Full_Package.tar.gz"

curl -o joomla.tar.gz -SL "${URL}"
echo "${SHA1} *joomla.tar.gz" | sha1sum -c -

mv joomla.tar.gz "${SRCDIR}"
chown www-data:www-data "${SRCDIR}/joomla.tar.gz"

apt-get purge "${BDEPS[@]}"
